<?xml version="1.0" encoding="utf-8" ?>
<Queries>

  <Paginacao>
    <querySelecionarCount>
      SELECT COUNT(1) FROM ( @MINHAQUERY@ ) C
    </querySelecionarCount>
    <querySelecionarPaginado>
      SET @row_number = 0;
      SELECT * FROM
      (
      SELECT
      (@row_number:=@row_number + 1) AS number, N.* FROM
      (
      @MINHAQUERY@
      ) N
      ) S
      WHERE
      (number BETWEEN @REGISTRO_INICIAL + 1 AND @REGISTRO_INICIAL + @QTD_A_RETORNAR)
    </querySelecionarPaginado>
  </Paginacao>

  <PerfilAcesso>
    <selecionarPerfilAcessoPorCodigo>
      SELECT
        PA.id_Perfil_Acesso,
        PA.nm_Perfil_Acesso,
        PA.moderador
      FROM
        master_colab.Perfil_Acesso PA
      WHERE
        (PA.id_Perfil_Acesso = @ID)
    </selecionarPerfilAcessoPorCodigo>
    <selecionarPerfisAcessoFiltrados>
      SELECT
        PA.id_Perfil_Acesso, 
        PA.nm_Perfil_Acesso, 
        PA.moderador
      FROM
        master_colab.Perfil_Acesso PA
      WHERE
        (@FILTRO IS NULL OR PA.nm_Perfil_Acesso LIKE ('%' + @FILTRO + '%'))
      ORDER BY @ORDER_BY
    </selecionarPerfisAcessoFiltrados>
    <inserirPerfilAcesso>
      INSERT INTO master_colab.Perfil_Acesso (nm_Perfil_Acesso, moderador)
      VALUES (@NOME, @MODERADOR)
    </inserirPerfilAcesso>
    <atualizarPerfilAcesso>
      UPDATE master_colab.Perfil_Acesso
      SET
        nm_Perfil_Acesso = @NOME,
        moderador = @MODERADOR
      WHERE 
        id_perfil = @CODIGO
    </atualizarPerfilAcesso>
    <excluirPerfilAcesso>
      DELETE FROM master_colab.Perfil_Acesso WHERE id_Perfil_Acesso = @ID
    </excluirPerfilAcesso>
  </PerfilAcesso>
  
  <Usuario>
    <validaUsuarioSenha>
      SELECT
        U.id_Usuario,
        U.id_Facebook,
        U.nm_Usuario,
        U.email,
        PA.id_Perfil_Acesso,
        PA.nm_Perfil_Acesso,
        PA.moderador
      FROM
        master_colab.Usuario U
        INNER JOIN master_colab.Perfil_Acesso PA ON PA.id_Perfil_Acesso = U.id_Perfil_Acesso
      WHERE
        U.email = @LOGIN AND
        DES_ENCRYPT(@SENHA) = U.senha
    </validaUsuarioSenha>
    <selecionarUsuarioPorCodigo>
      SELECT
        U.id_Usuario,
        U.id_Facebook,
        U.nm_Usuario,
        U.email,
        PA.id_Perfil_Acesso,
        PA.nm_Perfil_Acesso,
        PA.moderador
      FROM
        master_colab.Usuario U
        INNER JOIN master_colab.Perfil_Acesso PA ON PA.id_Perfil_Acesso = U.id_Perfil_Acesso
      WHERE
        U.id_Usuario = @ID
    </selecionarUsuarioPorCodigo>
    <selecionarUsuariosFiltrados>
      SELECT
        U.id_Usuario,
        U.id_Facebook,
        U.nm_Usuario,
        U.email,
        PA.id_Perfil_Acesso,
        PA.nm_Perfil_Acesso,
        PA.moderador
      FROM
        master_colab.Usuario U
        INNER JOIN master_colab.Perfil_Acesso PA ON PA.id_Perfil_Acesso = U.id_Perfil_Acesso
      WHERE
        (@FILTRO IS NULL OR U.nm_Usuario LIKE ('%' + @FILTRO + '%'))
      ORDER BY @ORDER_BY
    </selecionarUsuariosFiltrados>
    <inserirUsuario>
      INSERT INTO master_colab.Usuario (nm_Usuario, email, id_Perfil_Acesso, senha) VALUES (@NOME, @EMAIL, @ID_PERFIL, DES_ENCRYPT(@SENHA))
    </inserirUsuario>
    <atualizarUsuario>
      UPDATE master_colab.Usuario
      SET
        nm_Usuario = @NOME,
        email = @EMAIL,
        id_Perfil_Acesso = @ID_PERFIL
      WHERE
        id_Usuario = @ID
    </atualizarUsuario>
    <excluirUsuario>
      DELETE FROM master_colab.Usuario WHERE id_Usuario = @ID
    </excluirUsuario>
  </Usuario>
  
</Queries>