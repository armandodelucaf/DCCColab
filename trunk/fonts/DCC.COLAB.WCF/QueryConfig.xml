<?xml version="1.0" encoding="utf-8" ?>
<Queries>

  <Paginacao>
    <querySelecionarCount>
      SELECT COUNT(1) FROM ( @MINHAQUERY@ ) C
    </querySelecionarCount>
    <querySelecionarPaginado>
      SET @row_number = 0;
      SELECT * FROM
      (
      SELECT
      (@row_number:=@row_number + 1) AS number, N.* FROM
      (
      @MINHAQUERY@
      ) N
      ) S
      WHERE
      (number BETWEEN @REGISTRO_INICIAL + 1 AND @REGISTRO_INICIAL + @QTD_A_RETORNAR)
    </querySelecionarPaginado>
  </Paginacao>

  <PerfilAcesso>
    <selecionarPerfilAcessoPorCodigo>
      SELECT
        PA.id_Perfil_Acesso,
        PA.nm_Perfil_Acesso,
        PA.moderador
      FROM
        dcccolab.Perfil_Acesso PA
      WHERE
        (PA.id_Perfil_Acesso = @ID)
    </selecionarPerfilAcessoPorCodigo>
    <selecionarPerfisAcessoFiltrados>
      SELECT
        PA.id_Perfil_Acesso, 
        PA.nm_Perfil_Acesso, 
        PA.moderador
      FROM
        dcccolab.Perfil_Acesso PA
      WHERE
        (@FILTRO IS NULL OR PA.nm_Perfil_Acesso LIKE CONCAT('%', @FILTRO, '%'))
      ORDER BY @ORDER_BY
    </selecionarPerfisAcessoFiltrados>
  </PerfilAcesso>
  
  <Usuario>
    <validaUsuarioSenha>
      SELECT
        U.id_Usuario,
        U.id_Facebook,
        U.nm_Usuario,
        U.email,
        PA.id_Perfil_Acesso,
        PA.nm_Perfil_Acesso,
        PA.moderador
      FROM
        dcccolab.Usuario U
        INNER JOIN dcccolab.Perfil_Acesso PA ON PA.id_Perfil_Acesso = U.id_Perfil_Acesso
      WHERE
        U.email = @LOGIN AND
        DES_ENCRYPT(@SENHA) = U.senha
    </validaUsuarioSenha>
    <selecionarUsuarioPorCodigo>
      SELECT
        U.id_Usuario,
        U.id_Facebook,
        U.nm_Usuario,
        U.email,
        PA.id_Perfil_Acesso,
        PA.nm_Perfil_Acesso,
        PA.moderador
      FROM
        dcccolab.Usuario U
        INNER JOIN dcccolab.Perfil_Acesso PA ON PA.id_Perfil_Acesso = U.id_Perfil_Acesso
      WHERE
        U.id_Usuario = @ID
    </selecionarUsuarioPorCodigo>
    <selecionarUsuariosFiltrados>
      SELECT
        U.id_Usuario,
        U.id_Facebook,
        U.nm_Usuario,
        U.email,
        PA.id_Perfil_Acesso,
        PA.nm_Perfil_Acesso,
        PA.moderador
      FROM
        dcccolab.Usuario U
        INNER JOIN dcccolab.Perfil_Acesso PA ON PA.id_Perfil_Acesso = U.id_Perfil_Acesso
      WHERE
        (@FILTRO IS NULL OR U.nm_Usuario LIKE CONCAT('%', @FILTRO, '%'))
      ORDER BY @ORDER_BY
    </selecionarUsuariosFiltrados>
    <inserirUsuario>
      INSERT INTO dcccolab.Usuario (nm_Usuario, email, id_Perfil_Acesso, senha) VALUES (@NOME, @EMAIL, @ID_PERFIL, DES_ENCRYPT(@SENHA))
    </inserirUsuario>
    <atualizarUsuario>
      UPDATE dcccolab.Usuario
      SET
        nm_Usuario = @NOME,
        email = @EMAIL,
        id_Perfil_Acesso = @ID_PERFIL
      WHERE
        id_Usuario = @ID
    </atualizarUsuario>
    <excluirUsuario>
      DELETE FROM dcccolab.Usuario WHERE id_Usuario = @ID
    </excluirUsuario>
    <atualizarSenhaUsuario>
      UPDATE dcccolab.Usuario
      SET
        senha = DES_ENCRYPT(@SENHA)
      WHERE
        id_Usuario = @ID
    </atualizarSenhaUsuario>
  </Usuario>

  <Disciplina>
    <selecionarDisciplinaPorCodigo>
      SELECT
        D.id_Disciplina,
        D.nm_Disciplina,
        D.nu_Periodo,
        D.cd_Disciplina
      FROM
        dcccolab.Disciplina D
      WHERE
        D.id_Disciplina = @ID
    </selecionarDisciplinaPorCodigo>
    <selecionarDisciplinasFiltradas>
      SELECT
        D.id_Disciplina,
        D.nm_Disciplina,
        D.nu_Periodo,
        D.cd_Disciplina
      FROM
        dcccolab.Disciplina D
      WHERE
        (@FILTRO IS NULL OR D.nm_Disciplina LIKE CONCAT('%', @FILTRO, '%') OR D.cd_Disciplina LIKE CONCAT('%', @FILTRO, '%'))
      ORDER BY @ORDER_BY
    </selecionarDisciplinasFiltradas>
    <inserirDisciplina>
      INSERT INTO dcccolab.Disciplina (nm_Disciplina, nu_Periodo, cd_Disciplina) VALUES (@NOME, @PERIODO, @CODIGO_DISCIPLINA)
    </inserirDisciplina>
    <atualizarDisciplina>
      UPDATE dcccolab.Disciplina
      SET
        nm_Disciplina = @NOME,
        nu_Periodo = @PERIODO,
        cd_Disciplina = @CODIGO_DISCIPLINA
      WHERE
        id_Disciplina = @ID
    </atualizarDisciplina>
    <excluirDisciplina>
      DELETE FROM dcccolab.Disciplina WHERE id_Disciplina = @ID
    </excluirDisciplina>
  </Disciplina>

  <Tema>
    <selecionarTemaPorCodigo>
      SELECT
        T.id_Tema,
        T.nm_Tema,
        T.ds_Tema,
        T.id_Disciplina,
        D.nm_Disciplina
      FROM
        dcccolab.Tema T
        INNER JOIN dcccolab.Disciplina D ON D.id_Disciplina = T.id_Disciplina
      WHERE
        T.id_Tema = @ID
    </selecionarTemaPorCodigo>
    <selecionarTemasFiltrados>
      SELECT
        T.id_Tema,
        T.nm_Tema,
        T.ds_Tema,
        T.id_Disciplina,
        D.nm_Disciplina
      FROM
        dcccolab.Tema T
        INNER JOIN dcccolab.Disciplina D ON D.id_Disciplina = T.id_Disciplina
      WHERE
        (@FILTRO IS NULL OR T.nm_Tema LIKE CONCAT('%', @FILTRO, '%') OR T.ds_Tema LIKE CONCAT('%', @FILTRO, '%')) AND
        (@ID_DISCIPLINA IS NULL OR T.id_Disciplina = @ID_DISCIPLINA)
      ORDER BY @ORDER_BY
    </selecionarTemasFiltrados>
    <inserirTema>
      INSERT INTO dcccolab.Tema (nm_Tema, ds_Tema, id_Disciplina) VALUES (@NOME, @DESCRICAO, @ID_DISCIPLINA)
    </inserirTema>
    <atualizarTema>
      UPDATE dcccolab.Tema
      SET
        nm_Tema = @NOME,
        ds_Tema = @DESCRICAO
      WHERE
        id_Tema = @ID
    </atualizarTema>
    <excluirTema>
      DELETE FROM dcccolab.Tema WHERE id_Tema = @ID
    </excluirTema>
  </Tema>
  
</Queries>